{% extends 'base.html' %}

{% block title %}Ch·∫©n ƒêo√°n - NGT{% endblock %}

{% block content %}
<style>
    /* Th√™m style cho n√∫t T·∫£i file */
    /* ·∫®n input[type=file] g·ªëc */
    #file-upload {
        display: none;
    }

    /* Style cho c√°i label ƒë·ªÉ tr√¥ng gi·ªëng button */
    .upload-label {
        display: inline-block;
        padding: 12px 20px;
        font-size: 1em;
        font-weight: bold;
        color: var(--text-dark); /* Ch·ªØ t·ªëi */
        background-color: var(--primary-color-muted); /* N·ªÅn m√†u x√°m/ph·ª• */
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        text-align: center;
    }
    
    .upload-label:hover {
        background-color: var(--primary-color); /* ƒê·ªïi m√†u khi hover */
        color: var(--background-dark);
    }
    
    .upload-container {
        text-align: center;
        margin-top: 15px;
    }

    .separator {
        text-align: center;
        color: var(--text-light);
        margin: 25px 0 15px 0;
        font-style: italic;
    }
</style>

<div class="diagnose-container">
    <div id="recording-panel">
        <div class="diagnose-header">
            <h2>B·∫Øt ƒë·∫ßu Ghi √¢m</h2>
            <a href="{{ url_for('history') }}" class="btn-history-link">Xem l·ªãch s·ª≠</a>
        </div>
        <p class="diagnose-instructions">
            H√£y ƒë∆∞a micro g·∫ßn mi·ªáng v√† ho m·ªôt c√°ch t·ª± nhi√™n. Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu.
        </p>
        
        <p class="diagnose-tip" style="font-style: italic; color: var(--text-light);">
            üí° <strong>M·∫πo:</strong> ƒê·ªÉ c√≥ k·∫øt qu·∫£ t·ªët nh·∫•t, b·∫°n n√™n ho k√©o d√†i <strong>t·ª´ 4 gi√¢y tr·ªü l√™n</strong> v√† ghi √¢m ·ªü </strong>n∆°i y√™n tƒ©nh</strong>.
        </p>
        
        <div class="recorder">
            <button id="record-button" class="record-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-mic-fill" viewBox="0 0 16 16">
                    <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/>
                    <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                </svg>
            </button>
            <div id="timer" class="timeline">00:00</div>
        </div>

        <p class="separator">-- ho·∫∑c --</p>
    
        <div class="upload-container">
            <label for="file-upload" class="upload-label">
                <i class="fas fa-upload"></i> T·∫£i file √¢m thanh l√™n
            </label>
            <input type="file" id="file-upload" accept="audio/wav, audio/mpeg, audio/mp3">
            <p style="font-size: 0.85em; color: var(--text-light); margin-top: 10px;">(Ch·∫•p nh·∫≠n file .wav, .mp3)</p>
        </div>
        </div>

    <div id="results-panel" style="display: none;">
        <div class="diagnose-header">
            <h2>K·∫øt qu·∫£ Ph√¢n t√≠ch</h2>
        </div>

        <div class="results-content" id="results-content">
            </div>

        <div id="result-player" style="display: none; margin-top: 20px; text-align: center;">
            <p style="color: var(--text-light);">B·∫°n c√≥ th·ªÉ nghe l·∫°i b·∫£n ghi √¢m c·ªßa m√¨nh:</p>
            <audio controls src="" style="display: block; margin: 10px auto;"></audio>
            <div class="result-actions" style="margin-top: 20px; display: flex; justify-content: center; gap: 1rem;">
                <button id="diagnose-again-button" class="btn btn-secondary">Ch·∫©n ƒëo√°n l·∫°i</button>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('history') }}" class="btn btn-primary">Xem l·ªãch s·ª≠</a>
                {% endif %}
            </div>
        </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script type="module" src="{{ url_for('static', filename='recorder.js') }}"></script>
{% endblock %}